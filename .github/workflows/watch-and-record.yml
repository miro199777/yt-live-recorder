name: Watch & Record YouTube Live

on:
  schedule:
    - cron: '*/20 * * * *'  # Check every 20 minutes
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  watch:
    runs-on: ubuntu-latest

    steps:
      - name: Install yt-dlp and jq
        run: |
          sudo apt update
          sudo apt install -y jq
          pip install -U yt-dlp

      - name: Store cookies from GitHub secret
        run: |
          echo "${{ secrets.YOUTUBE_COOKIES }}" > cookies.txt

      - name: Check if channel is live
        id: livecheck
        run: |
          LIVE_JSON=$(yt-dlp --cookies cookies.txt --geo-bypass --age-limit 18 -j https://www.youtube.com/channel/UCXyYrNFS1V1HXa_nZvqtZtQ)
          IS_LIVE=$(echo "$LIVE_JSON" | jq -r '.is_live')
          echo "is_live=$IS_LIVE" >>
